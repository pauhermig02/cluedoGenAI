create_scene_blueprint:
  description: >
    Using the current {game_state} and the latest {player_action}, design the
    next narrative scene of the murder mystery. Focus on:
    1. Where the scene takes place and who is present
    2. What is happening right now (summary and key dramatic beats)
    3. Which clues are visible to the player
    4. Which tensions or secrets are hidden beneath the surface
    5. What overall mood and visual hooks define this moment
  expected_output: >
    A valid JSON "scene_blueprint" object with at least:
    - "scene_id": unique id or name of the scene
    - "location": short description of the place
    - "summary": 2–4 sentences describing the current situation
    - "present_characters": list of character ids or names in the scene
    - "beats": ordered list of key dramatic beats
    - "visible_clues": list of clues that can be noticed now
    - "hidden_tension": 1–2 sentences about underlying conflict/secrets
    - "music_mood": a simple label for the audio agent (e.g. "tense", "calm")
    - "visual_hooks": list of strong visual elements for the vision agent
    - "victim_name": full name of the victim
  agent: narrative_agent
  output_file: artifacts/scene_blueprint.json
  

define_characters:
  description: >
    Given the current scene_blueprint and the overall premise, generate a complete 
    set of four suspect profiles for the murder mystery following the exact JSON 
    schema and rules. Focus on creating distinct,vivid personalities, realistic 
    tech-industry roles, unique physical descriptions, subtle motivations, and 
    ensuring exactly one suspect is guilty. Output must be pure JSON with no extra text.
  expected_output: >
    You MUST return ONLY valid JSON, with no markdown, no backticks and no extra text.
    The JSON must have EXACTLY this structure (field names must match):

    {
      "suspects": [
        {
          "id": "suspect_1",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "clue_object": "A small, concrete physical object they are holding or fidgeting with that subtly hints at their secret (e.g., 'a crumpled letter', 'a nervous habit with a lighter', 'a weirdly encrypted USB').",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": "True if this character is guilty (i.e., they are the murderer) or false if they are not"
        },
        {
          "id": "suspect_2",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "clue_object": "A small, concrete physical object they are holding or fidgeting with that subtly hints at their secret (e.g., 'a crumpled letter', 'a nervous habit with a lighter', 'a weirdly encrypted USB').",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": "True if this character is guilty (i.e., they are the murderer) or false if they are not"
        },
        {
          "id": "suspect_3",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "clue_object": "A small, concrete physical object they are holding or fidgeting with that subtly hints at their secret (e.g., 'a crumpled letter', 'a nervous habit with a lighter', 'a weirdly encrypted USB').",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": "True if this character is guilty (i.e., they are the murderer) or false if they are not"
        },
        {
          "id": "suspect_4",
          "name": "Full Name",
          "role": "Job/position in the tech company"
          "age": integer,
          "role": "Job/position in the tech company"
          "age": integer,
          "personality": "Short description (1–2 sentences)",
          "physical_description": {
            "build": "skinny|fit|fat",
            "face": "short phrase describing facial traits",
            "hair": "short phrase describing hairstyle/color",
            "upper_clothing": "specific color + garment (must be a unique color per suspect)",
            "distinctive_features": "short phrase (tattoos, posture, accessories)"
            },
          "secret_motivation": "Hidden goal, fear or conflict. Must be subtle, realistic, and related to workplace context",
          "clue_object": "A small, concrete physical object they are holding or fidgeting with that subtly hints at their secret (e.g., 'a crumpled letter', 'a nervous habit with a lighter', 'a weirdly encrypted USB').",
          "alibi": "Short description of where they claim to be during the murder window",
          "guilty": "True if this character is guilty (i.e., they are the murderer) or false if they are not"
        }
      ],
      "guilty_name": "Full Name of the guilty suspect"
    }
    Constraints:
    - First, look at create_scene_blueprint. For every character name/role 
       mentioned there, you must create a matching profile here (same name, same role).
    - If the scene_blueprint has fewer than 4 characters, create unique new suspects 
       to reach a total of exactly 4.
    - The descriptions here must match what was described in the scene.
    - Roles must fit inside a tech company.
    - Personalities must be vivid and unique.
    - Physical descriptions must emphasize facial features, hair, clothing, and distinctive traits.
    - The clothing color must not repeat across suspects.
    - Motivations must feel plausible, not melodramatic.
    - Do not include explanations, commentary, or meta-reasoning.
    - Exactly 4 suspects.
    - Exactly ONE of them must have "guilty": true.
    - The "guilty" character can be anyone, make it random, not always the same number of character.
    - "guilty_name" must match the "name" of the guilty suspect.
    - Final output must be valid JSON, with no markdown and no trailing commas.
  agent: character_agent
  context:
    - create_scene_blueprint
  output_file: artifacts/characters.json


generate_suspect_dialogue:
  description: >
    Strictly generate the next dialogue turn for a suspect in a murder mystery.
    === INPUTS ===
    - {game_state}: full case summary, including suspects with roles,
      personalities, secrets, and instructions on which suspect to role-play
    - {scene_blueprint}: current scene context from the narrative agent
    - {characters}: suspect definitions from the personality agent
    - {player_action}: previous Q&A plus the latest detective question
    Using ONLY the information above, generate the next dialogue turn for the chosen suspect.
  rules: >
    - Always stay strictly in-character
    - Never reveal who the killer is
    - Answer only the latest detective question
    - Keep dialogue concise, immersive, and consistent with prior facts
    - Optionally reveal subtle new facts or hints, but never the solution
    - Treat all information outside {game_state}, {scene_blueprint}, {characters}, and {player_action} as irrelevant
  notes: >
    - Dialogue history is provided within {player_action}; the agent never reads external memory directly
    - Outputs are intended for updating the investigation memory and advancing the scene
  focus_on:
    1. Staying strictly in-character according to suspect's personality and role
    2. Answering the latest question directly
    3. Maintaining consistency with case logic and prior facts
    4. Optionally revealing subtle new facts or clues
    5. Keeping dialogue immersive, concise, and around 80–100 words
  expected_output: >
    A valid JSON object containing exactly these fields:
      {
        "spoken_text": "...",
        "inner_thoughts": "...",
        "revealed_facts": [],
        "implied_clues": []
      }
  agent: dialogue_agent
  context:
    - create_scene_blueprint
    - define_characters

design_scene_visuals:
  description: >
    You will receive the output from 'define_characters', which is a JSON object
    containing a list of exactly 4 suspects in the "suspects" array.

    Your goal is to generate a visual portrait for EACH suspect using the
    'Generate Character Image' tool.

    Step-by-step instructions:
    1. Parse the incoming JSON to find the "suspects" list.
    2. Iterate through every suspect in that list.
    3. For each suspect, extract their individual data object (including name,
       physical_description, and clue_object) as a JSON string.
    4. Call the 'Generate Character Image' tool passing that individual JSON string.

    CRITICAL: You must execute the tool exactly 4 times (once per suspect).
  expected_output: >
    Output MUST be ONLY valid JSON (no markdown, no extra text) with this structure:
    {
      "suspect_images": {
        "Dr. Aris Thorne": "src/cluedogenai/generated_images/Dr_Aris_Thorne_Lead_Robotics_Engineer.png",
        "Alex Chen": "src/cluedogenai/generated_images/Alex_Chen_Cybersecurity_Analyst.png"
      },
      "failed": {
        "Maya Sharma": "security_filters",
        "Chloe Davies": "security_filters"
      }
    }
  agent: vision_agent
  context:
    - define_characters
  output_file: artifacts/suspect_images.json